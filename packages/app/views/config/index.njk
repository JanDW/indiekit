{% extends "document.njk" %}

{% set title = __("Configuration") %}

{% block content %}
  {{ summary({
    title: __("config.app.title"),
    actions: [{
      href: "/config/application?referrer=/config",
      text: __("Edit")
    }],
    rows: [{
      key: {
        text: __("config.app.locale.label")
      },
      value: {
        text: __("locale." + app.locale)
      }
    }, {
      key: {
        text: __("config.app.publisherId.label")
      },
      value: {
        text: __("publisherId." + app.publisherId)
      }
    }, {
      key: {
        text: __("config.app.themeColor.label")
      },
      value: {
        text: "<span style=\"color:" + app.themeColor + "\" aria-hidden\"true\">‚óè</span> " + app.themeColor
      }
    }]
  }) }}

  {{ summary({
    title: __("config.github.title"),
    actions: [{
      href: "/config/github?referrer=/config",
      text: __("Edit")
    }],
    rows: [{
      key: {
        text: __("config.github.user.label")
      },
      value: {
        text: github.user
      }
    }, {
      key: {
        text: __("config.github.repo.label")
      },
      value: {
        text: github.repo
      }
    }, {
      key: {
        text: __("config.github.branch.label")
      },
      value: {
        text: github.branch
      }
    }, {
      key: {
        text: __("config.github.token.label")
      },
      value: {
        text: github.token
      }
    }]
  }) if app.publisherId == "github" }}

  {{ summary({
    title: __("config.gitlab.title"),
    actions: [{
      href: "/config/gitlab?referrer=/config",
      text: __("Edit")
    }],
    rows: [{
      key: {
        text: __("config.gitlab.instance.label")
      },
      value: {
        text: gitlab.instance
      }
    }, {
      key: {
        text: __("config.gitlab.user.label")
      },
      value: {
        text: gitlab.user
      }
    }, {
      key: {
        text: __("config.gitlab.repo.label")
      },
      value: {
        text: gitlab.repo
      }
    }, {
      key: {
        text: __("config.gitlab.branch.label")
      },
      value: {
        text: gitlab.branch
      }
    }, {
      key: {
        text: __("config.gitlab.token.label")
      },
      value: {
        text: gitlab.token
      }
    }]
  }) if app.publisherId == "gitlab" }}

  {%- set bookmarklet %}
    {% set bookmarkletFunction -%}
      (function() {
        var title = document.getElementsByTagName('title')[0].innerHTML;
        name = encodeURIComponent(title);

        var selection = '';
        if (window.getSelection) {
          selection = window.getSelection().toString();
        } else if (document.selection && document.selection.type != 'Control') {
          selection = document.selection.createRange().text;
        }
        content = encodeURIComponent(selection);

        new_window=window.open(
          '{{ app.url }}/share/bookmarklet?name='+name+'&content='+content+'&url='+encodeURIComponent(document.location.href),
          'Sharer',
          'resizable,scrollbars,status=0,toolbar=0,menubar=0,titlebar=0,width=640,height=720,location=0'
        );
      })();
    {%- endset %}
    {% set bookmarkletHref = "javascript:" + bookmarkletFunction | replace("  ", "") | replace("\n", "") | replace("&", "&amp;") | trim %}
    {{ bookmarklet({
      href: bookmarkletHref,
      text: __("Share page")
    }) if not minimalui }}
  {%- endset %}

  {{ summary({
    title: __("config.pub.title"),
    actions: [{
      href: "/config/publication?referrer=/config",
      text: __("Edit")
    }],
    rows: [{
      key: {
        text: __("config.pub.me.label")
      },
      value: {
        text: pub.me
      }
    }, {
      key: {
        text: __("config.pub.configPath.label")
      },
      value: {
        text: pub.configPath + "<br>(<a href=\"/config/publication/settings\">" + __("View configuration") + "</a>)"
      }
    }, {
      key: {
        text: __("config.pub.bookmarklet.label")
      },
      value: {
        text: __("config.pub.bookmarklet.drag") + ": " + bookmarklet
      }
    }]
  }) }}
{% endblock %}
{% from "preview/macro.njk" import preview %}

{% extends "_form.njk" %}

{% set title = "Share" %}

{% block content %}
  {{ preview({
    title: name,
    content: content,
    date: "now"
  }) }}

  {{ input ({
    label: {
      text: __("Title")
    },
    name: "name",
    value: name
  }) }}

  {{ input ({
    label: {
      text: __("URL")
    },
    name: "bookmark-of",
    value: url
  }) }}

  {{ textarea({
    label: {
      text: __("Content")
    },
    name: "content",
    value: content
  }) | indent(8) }}

  {{ input({
    type: "hidden",
    name: "access_token-of",
    value: session.indieauthToken
  }) }}

  {{ input({
    type: "hidden",
    name: "h",
    value: entry
  }) }}

  {{ button({
    attributes: {
      formaction: "/micropub"
    },
    text: __("Publish")
  }) }}
{% endblock %}

{% block scripts %}
<script>
  let share = document.querySelector('.form');
  let title = document.getElementById('title');
  let titlePreview = document.querySelector('output[for="title"]');
  let content = document.getElementById('content');
  let contentPreview = document.querySelector('output[for="content"]');
  share.oninput = handleInput;
  function handleInput(e) {
    titlePreview.value = decodeURIComponent(title.value);
    contentPreview.value = content.value;
  }
</script>
{% endblock %}